## MSA 도구 및 기술

### Spring Cloud
* Spring Cloud Bus
* ZooKeeper
* Streams
* Netflix Zuul
* Netflix Feign
* Security
* Sleuth

### Spring Cloud Netflix
* MSA에서 중요한 요소 중 하나는 자동 확장 (Auto Scale-out)
* 특정 서비스에 트래픽이나 부하가 증가할 경우 인스턴스의 수를 늘림(Scale-out)
* 트래픽과 부하가 감소할 경우 불필요한 인스턴스를 서비스에서 제거
* 클라우드 기반의 인프라 환경에서는 Auto Scaling은 필수
* 변경이 잦은 서비스간 로드밸런싱과 장애 대응 필요

### Spring Cloud - Config Server
* Config Server는 마이크로서비스의 환경설정정보 - 특히 서비스, 비즈니스 로직과 연관성이 있는 정보들을 어플리케이션과 분리해 외부의 서버를 통해 관리해주는 기술
    * 환경설정 파라미터들을 외부화하고 개발, 테스트, 운영 등의 여러 개의 프로파일로 운영되는 마이크로서비스의 설정들을 중앙집중적으로 관리
    * 마이크로서비스의 어떠한 설정이 변경되었을 때 서버 재시작 없이 동적으로 적용
    1. Config Server 구동 후 Git 등의 저장소로 환경 설정 정보 얻어옴
    2. 마이크로 서비스는 컨피그 서버에 접근해서 환경 설정 정보를 읽어온다.
    3. 갱신을 위한 API 호출 -> 변경된 환경설정 정보 적용
* Spring cloud bus는 동적으로 config 변경을 적용하기 위한 MQ Handler
* Config Server 설정파일 예시 - application.yml
* 개발, 테스트, 운영 등의 여러 개의 프로파일로 운영되는 마이크로서비스의 여러 인스턴스들의 환경설정 속성을 외부화하고 중앙 집중화해서 관리할 수 있도록 지원하는 라이브러리

### Spring Cloud Netflix - Eureka, Ribbon, Hystrix
* Eureka - 서비스 디스커버리 서버
* Ribbon - 클라이언트 사이드 로드 밸런서
* Hystrix - 서킷 브레이커 (회로 차단기)
* 변경이 잦은 서비스 간 로드 밸런싱과 서비스 탐색 및 장애 대응 필요
#### Eureka
* 인스턴스의 상태를 동적으로 관리하는 서버 = 서비스 디스커버리 서버
* 주요기능
    * 새로운 인스턴스는 시작할 때 Eureka 서버에 IP, 호스트 주소, 포트 정보 등을 스스로 전송
    * Eureka 서버는 받은 정보를 가지고 일정한 간격으로 상태를 체크하면서 해당 인스턴스 관리
    * 인스턴스가 새로 실행될 때마다 자신의 정보를 서버에 동적으로 등록
클라이언트 사이드 디스커버리 패턴 - Spring Cloud Netflix - Eureka
서버 사이드 디스커버리 패턴 - AWS ELB
* Eureka Client를 사용할 모든 Server에 Eureka Client 탑재
    * 서비스 기동 시 등록, 종료 시 삭제
    * 서비스 인스턴스 추가 및 삭제 (Scale-out, Scale-in)시 자동 등록, 자동 삭제
    * 서비스를 수평 확장할 때 IP 정보에 대해 신경 쓸 필요가 없음
#### Ribbon
* 소프트웨어 방식의 Client-Side Load Balancer
* 요청을 보내는 클라이언트 측에서 서버의 부하 분산 수행 (다양한 알고리즘 지원)
* 로드 밸런서의 특징 상 단독으로 사용하기보다 API Gateway, Eureka와 같이 사용하는 경우가 많음
* 모놀리식 시스템에서는 부하 분산을 위해 L4/L7 스위치 같은 하드웨어 장비를 앞단에 두고 트래픽을 여러 서버로 분산시키는 방식이 일반적 (ELB의 경우에도 논리적인 스위치의 개념)
* 로드 밸런서 장비 (하드웨어)에 장애가 발생하면 전체 서비스에 장애가 생기는 리스크가 높음
* 동적으로 서버가 추가, 삭제 되는 클라우드 환경에서 하드웨어 장비로 대응하는 것도 한계
* Ribbon - 소프트웨어로 구현한 클라이언트 로드 밸런서
* 클라이언트 - MSA에서 다른 서비스를 호출하는 클라이언트 서비스
* 주요기능
    * Rule - 요청을 보낼 서버를 선택하는 알고리즘 (서비스 선택 알고리즘)
    * Ping - 서버 list가 살아있는지 체크하는 로직
        * 주기적으로 서버들의 상태를 체크, 서버가 죽었거나 비활성화 상태면 목록에서 삭제
    * ServerList - 로드밸런싱의 대상인 서버 목록 제공
        * Eureka 등을 기반으로 dynamic하게 설정 가능
    * Retry - 연결한 server에게 응답을 받지 못하였을 경우 동일한 서버로 재시도 하거나 다른 서버로 재시도하는 기능
#### Spring Cloud Circuit Breaker

